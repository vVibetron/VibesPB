<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Georgia ZIP Code Map</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS for mapping -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #map {
            height: 60vh;
            width: 100%;
            background-color: #374151; /* gray-700 */
        }
        .leaflet-tooltip {
            background: transparent;
            border: none;
            box-shadow: none;
            color: #111827; /* gray-900 */
            font-weight: bold;
            font-size: 10px;
            text-shadow: 0 0 2px white;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto">
        <!-- Header Section -->
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-white">Interactive Georgia ZIP Code Map</h1>
            <p class="text-gray-400 mt-2">Click on a ZIP code to select or deselect it.</p>
        </div>

        <!-- Map Container -->
        <div id="map" class="rounded-lg shadow-2xl border-2 border-gray-600"></div>

        <!-- Selected ZIP Codes Section -->
        <div class="mt-6 bg-gray-800 p-4 rounded-lg shadow-lg">
            <label for="selected-zips" class="block text-lg font-semibold mb-2">Selected ZIP Codes:</label>
            <div class="flex gap-4">
                <textarea id="selected-zips" readonly class="w-full h-24 bg-gray-900 border border-gray-600 rounded-md p-2 text-gray-300 resize-none"></textarea>
                <button id="copy-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-bold self-center">Copy</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // --- Initial Setup ---
        const initialZips = [
            '30117', '30339', '30144', '30152', '30008', '30060', '30062', 
            '30064', '30065', '30066', '30067', '30068', '30127', '30080', 
            '30082', '30083'
        ];
        const selectedZips = new Set(initialZips);
        const selectedZipsTextarea = document.getElementById('selected-zips');
        const copyBtn = document.getElementById('copy-btn');
        let geoJsonLayer;

        // --- Map Initialization ---
        // The map is centered on Georgia.
        const map = L.map('map').setView([32.8, -83.5], 7);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // --- Styling Functions ---
        const styles = {
            default: {
                fillColor: '#6b7280', // gray-500
                weight: 1,
                opacity: 1,
                color: '#1f2937', // gray-800
                fillOpacity: 0.6
            },
            selected: {
                fillColor: '#facc15', // yellow-400
                weight: 2,
                opacity: 1,
                color: '#facc15', // yellow-400
                fillOpacity: 0.7
            }
        };

        function getStyle(feature) {
            return selectedZips.has(feature.properties.ZCTA5CE10) ? styles.selected : styles.default;
        }

        // --- Interaction Functions ---
        function onEachFeature(feature, layer) {
            const zipCode = feature.properties.ZCTA5CE10;
            
            // Display the ZIP code permanently on the map
            layer.bindTooltip(zipCode, { permanent: true, direction: 'center', className: 'leaflet-tooltip' });

            // Handle click events
            layer.on('click', function(e) {
                if (selectedZips.has(zipCode)) {
                    selectedZips.delete(zipCode);
                    layer.setStyle(styles.default);
                } else {
                    selectedZips.add(zipCode);
                    layer.setStyle(styles.selected);
                }
                updateSelectedZipsField();
            });
        }
        
        function updateSelectedZipsField() {
            selectedZipsTextarea.value = Array.from(selectedZips).sort().join(', ');
        }
        
        copyBtn.addEventListener('click', () => {
            selectedZipsTextarea.select();
            document.execCommand('copy');
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = 'Copy';
            }, 2000);
        });

        // --- Data Loading and Rendering ---
        // Fetch GeoJSON data for Georgia ZIP codes
        fetch('https://raw.githubusercontent.com/OpenDataDE/State-zip-code-GeoJSON/master/ga_georgia_zip_codes_geo.min.json')
            .then(response => response.json())
            .then(data => {
                geoJsonLayer = L.geoJson(data, {
                    style: getStyle,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // Initialize the text field with the pre-selected ZIPs
                updateSelectedZipsField();
            })
            .catch(error => {
                console.error("Could not load GeoJSON data:", error);
                alert("Failed to load map data. Please try refreshing the page.");
            });

    </script>
</body>
</html>
